# CI/CD: непрерывная интеграция и доставка

## Что такое CI/CD?

**CI/CD** (Continuous Integration / Continuous Delivery) — это набор практик и автоматизированных процессов, которые позволяют командам разработки быстро, надёжно и с минимальными рисками доставлять изменения кода пользователям.

- **CI (Continuous Integration)** — разработчики часто (несколько раз в день) интегрируют свои изменения в общую ветку репозитория. После каждого коммита автоматически запускается сборка и выполняются тесты. Это позволяет обнаруживать конфликты и ошибки на самых ранних этапах.

- **CD (Continuous Delivery / Continuous Deployment)** — развитие CI, автоматизирующее подготовку к релизу и развёртывание.
  - **Continuous Delivery** — код всегда находится в состоянии, готовом к выкатке в продакшен. Решение о релизе принимается вручную (например, нажатием кнопки).
  - **Continuous Deployment** — каждое изменение, успешно прошедшее все этапы пайплайна, автоматически попадает в продакшен без участия человека.

---

## Зачем нужен CI/CD?

- **Скорость** – автоматизация ускоряет проверку и выкатку изменений.
- **Качество** – тесты запускаются на каждый коммит, ошибки находятся раньше.
- **Надёжность** – процессы стандартизированы, меньше ручных ошибок.
- **Безопасность** – можно встроить проверки безопасности в пайплайн.
- **Удовлетворённость команды** – меньше стресса перед релизами, быстрая обратная связь.

---

## Этапы CI/CD пайплайна

Типичный пайплайн включает следующие этапы (граница между CI и CD условна):

| Этап                     | Описание                                                                                           | Относится к |
|--------------------------|----------------------------------------------------------------------------------------------------|-------------|
| **Commit**               | Разработчик пушит код в репозиторий                                                                | CI          |
| **Build**                | Сборка проекта (компиляция, установка зависимостей, упаковка)                                      | CI          |
| **Test**                 | Модульные и интеграционные тесты                                                                   | CI          |
| **Static Analysis**      | Линтеры, проверка стиля, анализ уязвимостей                                                        | CI          |
| **Package**              | Создание артефакта (Docker-образ, JAR, deb и т.д.) и публикация в реестр                           | CI/CD       |
| **Deploy to Staging**    | Развёртывание на тестовое окружение, максимально близкое к продакшену                              | CD          |
| **Acceptance Tests**     | Автоматические тесты на стейджинге (дымовые, приёмочные)                                           | CD          |
| **Deploy to Production** | Выкатка в продакшен (вручную — для Continuous Delivery, автоматически — для Continuous Deployment) | CD          |

---

## Основные компоненты

| Компонент                   | Роль                                                                        |
|-----------------------------|-----------------------------------------------------------------------------|
| **Система контроля версий** | Хранит код, запускает пайплайн по событиям (push, pull request).            |
| **CI/CD сервер**            | Оркестрирует выполнение пайплайна (Jenkins, GitLab Runner, GitHub Actions). |
| **Артефакты**               | Результаты сборки (образы, пакеты), хранятся в реестре (Docker Hub, Nexus). |
| **Тестовая среда**          | Окружение для автоматических тестов (staging, test).                        |
| **Инфраструктура**          | Серверы, Kubernetes, облака, где разворачивается приложение.                |

---

## Популярные инструменты CI/CD

| Инструмент         | Особенности                                                           |
|--------------------|-----------------------------------------------------------------------|
| **Jenkins**        | Самый популярный self-hosted, гибкий, огромное количество плагинов.   |
| **GitLab CI**      | Встроен в GitLab, конфигурация в `.gitlab-ci.yml`, удобные окружения. |
| **GitHub Actions** | Встроен в GitHub, простой YAML-синтаксис, бесплатно для open-source.  |
| **CircleCI**       | Облачный сервис, быстрая настройка, хорошая производительность.       |
| **Travis CI**      | Раньше популярен для open-source, сейчас ограничен бесплатный тариф.  |
| **TeamCity**       | От JetBrains, мощный UI, но требует установки.                        |
| **ArgoCD**         | Инструмент для Continuous Delivery в Kubernetes (GitOps-подход).      |

---

## Пример простого пайплайна (GitHub Actions)

```yaml
name: CI/CD

on:
  push:
    branches: [ main ]

jobs:
  build-and-test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Install dependencies
        run: npm ci
      - name: Run tests
        run: npm test
      - name: Build
        run: npm run build

  deploy:
    needs: build-and-test
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    steps:
      - name: Deploy to production
        run: curl -X POST https://deploy.example.com
```

Этот пример иллюстрирует минимальный пайплайн: после пуша в `main` запускаются сборка и тесты, а затем — деплой (здесь просто вызов внешнего API).

---

## Разница между Continuous Delivery и Continuous Deployment

|                    | Continuous Delivery                                    | Continuous Deployment                                      |
|--------------------|--------------------------------------------------------|------------------------------------------------------------|
| **Автоматизация**  | До staging — полностью, до production — ручной триггер | Полностью автоматический процесс до production             |
| **Риск**           | Ниже (человек контролирует)                            | Выше (требуется высокая уверенность в тестах)              |
| **Скорость**       | Высокая, но с задержкой на утверждение                 | Максимальная, изменения попадают к пользователям за минуты |
| **Когда выбирать** | Если нужен ручной контроль перед релизом               | SaaS-продукты, зрелые тесты, быстрая обратная связь        |

---

## Связь с подробными руководствами

В этом репозитории вы можете найти отдельные файлы, посвящённые каждой части CI/CD:

- **[Непрерывная интеграция (CI): подробное руководство](ci.md)** — всё о CI: цели, компоненты, примеры, антипаттерны.
- **[Continuous Delivery и Continuous Deployment (CD): подробное руководство](cd.md)** — стратегии развёртывания, пайплайны, сравнение Delivery и Deployment.

---

## Заключение

CI/CD — это не просто набор инструментов, а культура автоматизации, которая делает процесс разработки предсказуемым, быстрым и надёжным. Начинать можно с простого CI-пайплайна (сборка + тесты на каждый коммит), постепенно добавляя этапы развёртывания и двигаясь к полной автоматизации. Главное — помнить, что CI/CD требует дисциплины: тесты должны быть качественными, а на сломанный пайплайн нужно реагировать немедленно.
