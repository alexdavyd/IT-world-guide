# Шардирование

Шардирование — это горизонтальное разделение данных на независимые части (шарды), каждая из которых хранится на отдельном сервере (или группе серверов). В отличие от репликации, где каждый узел содержит все данные, при шардировании каждый узел содержит только свою часть.

**Цели шардирования:**
- Преодоление ограничений одного сервера по объёму данных и пропускной способности записи.
- Распределение нагрузки записи между узлами.

## Как работает шардирование?
- Данные распределяются по шардам на основе **ключа шардирования** (shard key). Например, для пользователей ключом может быть `user_id`.
- Приложение (или промежуточный слой) вычисляет, на каком шарде находятся нужные данные, и отправляет запрос напрямую туда.
- Шарды могут быть реплицированы для отказоустойчивости (каждый шард — это свой кластер master-slave).

## Пример
Представим таблицу `users` с 1 млрд записей. Мы создаём 4 шарда. По правилу `user_id % 4 = 0` попадает на шард A, `%4=1` — на шард B и т.д. Каждый шард содержит примерно 250 млн записей и может обрабатывать свою долю запросов независимо.

## Проблемы шардирования
- Сложность выполнения шардовых запросов (JOIN, транзакции).
- Неравномерное распределение данных (перекос).
- Изменение количества шардов требует ребалансировки данных.
