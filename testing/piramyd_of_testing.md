# Пирамида тестирования

Пирамида тестирования — это концептуальная модель, предложенная Майком Коном в книге «Succeeding with Agile». Она описывает оптимальное соотношение разных видов тестов в автоматизированном наборе, помогая командам создавать надёжные, быстрые и легко поддерживаемые тесты.

---

## Уровни пирамиды

Пирамида состоит из трёх основных слоёв:

```
      /\
     /  \
    / UI \
   /______\
  /        \
 / Сервисные \
/______________\
/                \
/  Юнит-тесты      \
/____________________\
```

### 1. Основание: юнит-тесты (модульные)
- **Что это:** тестирование отдельных функций, классов или методов в изоляции.
- **Количество:** много (десятки, сотни, тысячи).
- **Скорость:** очень быстрые (миллисекунды).
- **Стоимость поддержки:** низкая.
- **Цель:** проверить корректность работы smallest units кода, обеспечить надёжную базу.

### 2. Середина: сервисные / интеграционные тесты
- **Что это:** тестирование взаимодействия между модулями, слоями приложения (API, базы данных, внешние сервисы).
- **Количество:** умеренное.
- **Скорость:** быстрые, но медленнее юнит-тестов (секунды).
- **Стоимость поддержки:** средняя.
- **Цель:** убедиться, что компоненты правильно работают вместе.

### 3. Вершина: UI / сквозные (end-to-end) тесты
- **Что это:** тестирование системы через пользовательский интерфейс, имитация реальных действий пользователя.
- **Количество:** мало (критически важные сценарии).
- **Скорость:** медленные (секунды/минуты).
- **Стоимость поддержки:** высокая (изменения в UI часто ломают тесты).
- **Цель:** проверить основные бизнес-сценарии от начала до конца.

---

## Почему пирамида?

Модель пирамиды основана на нескольких важных наблюдениях:

- **Скорость обратной связи:** чем ниже уровень, тем быстрее выполняются тесты. Разработчик должен получать обратную связь за минуты, а не часы.
- **Стабильность:** юнит-тесты стабильны, UI-тесты часто «хрупки» (ломаются от незначительных изменений в вёрстке).
- **Стоимость написания и поддержки:** UI-тесты требуют больше усилий при разработке и обновлении.
- **Локализация ошибок:** при падении юнит-теста сразу ясно, какой компонент сломан; падение UI-теста требует расследования.

---

## Преимущества следования пирамиде

- Быстрая обратная связь для разработчиков.
- Снижение затрат на поддержку тестов.
- Высокая степень покрытия логики (юнит-тесты) при сохранении уверенности в критических сценариях.
- Меньше «ложных срабатываний» (flaky tests).
- Устойчивость к изменениям: рефакторинг UI не ломает тысячи тестов.

---

## Антипаттерн: «Мороженое» (Ice Cream Cone)

Иногда встречается перевёрнутая пирамида — много UI-тестов, мало юнит-тестов. Это называют «мороженым» (или «сосулькой»). Такой подход приводит к:

- Медленным тестовым прогонам.
- Хрупким тестам, которые часто падают из-за пустяков.
- Сложности локализации дефектов.
- Высокой стоимости поддержки.

---

## Современные вариации

- **Принцип медальона (Testing Trophy)** — предложен Кентом Доддсом: больше внимания сервисным/интеграционным тестам, чуть меньше юнит-тестам, ещё меньше UI. Особенно актуален для архитектур с сильной бизнес-логикой на серверной стороне.
- **Модель «Стакан» (Glass)** — учитывает статические проверки, линтеры, формальные верификации как дополнительный фундамент.

---

## Рекомендации

1. **Начинайте с юнит-тестов** — они должны покрывать основную бизнес-логику и сложные алгоритмы.
2. **Добавляйте интеграционные тесты** для проверки взаимодействия с БД, внешними API, файловой системой.
3. **Пишите UI-тесты только для самых важных пользовательских путей** (счастье + критические ошибки).
4. **Автоматизируйте с умом** — не пытайтесь покрыть UI-тестами всё, это дорого и ненадёжно.
5. **Регулярно пересматривайте пирамиду** — с ростом проекта пропорции могут меняться.

---

## Заключение

Пирамида тестирования — это не догма, а полезная метафора для построения сбалансированного набора автотестов. Следуя ей, вы получаете быстрые, стабильные и поддерживаемые тесты, которые помогают выпускать качественный продукт без страха перед регрессией.